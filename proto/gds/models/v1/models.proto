syntax="proto3";

package gds.models.v1;
option go_package = "github.com/trisacrypto/directory/pkg/gds/models/v1;models";

import "gds/global/v1/global.proto";

// Certificate requests are maintained separately from the VASP record since they should
// not be replicated. E.g. every directory process is responsible for certificate
// issuance and only public keys and certificate metadata should be exchanged between
// directories.
message CertificateRequest {
    // A unique identifier generated by the directory service, should be a globally
    // unique identifier generated by the replica specified in requesting_replica.
    string id = 1;

    // The replica that generated the certificate request should be the only replica
    // that handles the certificate request. The request is replicated for information
    // and backup purposes only.
    string owner = 2;

    // VASP information for the request
    string vasp = 3;
    string common_name = 4;

    // Request pipeline status
    CertificateRequestState status = 5;

    // Sectigo create single certificate batch metadata
    int64 authority_id = 6;
    int64 batch_id = 7;
    string batch_name = 8;
    string batch_status = 9;
    int64 order_number = 10;
    string creation_date = 11;
    string profile = 12;
    string reject_reason = 13;

    // Logging information timestamps
    string created = 15;
    string modified = 16;
    string deleted = 17;
    gds.global.v1.Object metadata = 18;
}

enum CertificateRequestState {
    INITIALIZED = 0;
    READY_TO_SUBMIT = 1;
    PROCESSING = 2;
    DOWNLOADING = 3;
    DOWNLOADED = 4;
    COMPLETED = 5;
    CR_REJECTED = 6;
    CR_ERRORED = 7;
}

// GDSExtraData contains all GDS-specific extra data for a VASP record.
message GDSExtraData {
    // Temporary: verification token for light weight authentication for verification
    // TODO: replace with admin API that uses authentication
    string admin_verification_token = 1;

    // RFC3339 timestamp that indicates the VASP record was deleted.
    string deleted_on = 2;

    gds.global.v1.Object metadata = 3;
}

// GDSContactExtraData contains all GDS-specific extra data for a Contact record.
message GDSContactExtraData {
    // Token for email verification
    bool verified = 1;
    string token = 2;
}